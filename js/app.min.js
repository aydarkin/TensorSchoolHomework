class Person{constructor({id:a,name:b,photo:c,birthDay:d,lastSession:e,phone:f,friends:g}){this.id=a,this.name=b,this.photo=c,this.birthDay=d?new Date(d):void 0,this.lastSession=e?new Date(e):void 0,this.phone=f,this.friends=g,g.data||(this.friends.data=this.getFriendsData(4))}get friendsCount(){return this.friends.count}getFriendsData(a){return[{id:2,photo:"img/ava2.jpg",name:"\u041F\u0435\u0442\u0440\u043E\u0432\u0430 \u0415\u043A\u0430\u0442\u0435\u0440\u0438\u043D\u0430"},{id:3,photo:"img/ava3.jpg",name:"\u0421\u0442\u043E\u043B\u043E\u0432\u0430\u044F \u041B\u043E\u0436\u043A\u0430"},{id:4,photo:"img/ava4.jpg",name:"\u0418\u0432\u0430\u043D\u043E\u0432 \u0418\u0432\u0430\u043D"},{id:5,photo:"img/ava5.jpg",name:"\u0418\u0432\u0430\u043D\u043E\u0432 \u0418\u043E\u0433\u0430\u043D\u043D"}]}}class Student extends Person{constructor({id:a,name:b,photo:c,birthDay:d,lastSession:e,phone:f,friends:g,university:h,course:i}){super({id:a,name:b,photo:c,birthDay:d,lastSession:e,phone:f,friends:g}),this.university=h,this.course=i}createCardPerson(){return renderCardPerson(this)}createPopup(){return renderPopupStudent(this)}}const studentModel={getData(){return[{id:"13",name:"\u041C\u0430\u0448\u0430 \u0418\u0432\u0430\u043D\u043E\u0432\u0430",birthDay:"1997-06-22",phone:"79372156891",lastSession:"2020-03-30T21:24:00",photo:"img/ava1.jpg",university:"\u0423\u0413\u0410\u0422\u0423",course:"2",friends:{count:"45",data:[]}},{id:"3",name:"\u041C\u0438\u0448\u0430 \u041F\u0435\u0442\u0440\u043E\u0432",birthDay:"1999-12-17",phone:"79242143891",lastSession:"2020-03-30T21:22:00",photo:"img/ava2.jpg",university:"\u0421\u0443\u0440\u0413\u0423",course:"3",friends:{count:"27",data:[]}},{id:"7",name:"\u041C\u0430\u0440\u0430\u0442 \u0421\u0438\u0434\u043E\u0440\u043E\u0432",birthDay:"1998-12-17",phone:"79992143891",lastSession:"2020-03-30T21:21:00",photo:"img/ava3.jpg",university:"\u0411\u0413\u0423",course:"4",friends:{count:"16",data:[]}},{id:"4",name:"\u0418\u0432\u0430\u043D \u0418\u0432\u0430\u043D\u043E\u0432",birthDay:"1998-12-17",phone:"79372143891",lastSession:"2020-03-31T21:24:00",photo:"img/ava4.jpg",university:"\u0422\u0413\u042E\u041A",course:"4",friends:{count:"55",data:[]}},{id:"2",name:"\u041E\u043A\u0441\u0430\u043D\u0430 \u041E\u043B\u0435\u0433\u043E\u0432\u043D\u0430",birthDay:"1998-12-17",phone:"79379993891",lastSession:"2020-03-31T21:22:00",photo:"img/ava5.jpg",university:"\u0423\u0413\u0410\u0422\u0423",course:"4",friends:{count:"78",data:[]}},{id:"23",name:"\u0421\u0442\u0430\u0441 \u041C\u0438\u0445\u0430\u0439\u043B\u043E\u0432",birthDay:"1995-02-09",phone:"79172143897",lastSession:"2020-03-30T21:14:00",photo:"img/ava6.jpg",university:"\u0411\u0413\u041F\u0423",course:"3",friends:{count:"140",data:[]}},{id:"132",name:"\u041D\u0438\u043A\u043E\u043B\u0430\u0439 \u0412\u0430\u0441\u044C\u043A\u0438\u043D",birthDay:"",phone:"79372143891",lastSession:"2020-03-29T21:12:00",photo:"img/ava7.jpg",university:"\u0411\u0413\u0423",course:"4",friends:{count:"439",data:[]}},{id:"113",name:"\u041E\u043B\u0435\u0433 \u041C\u0430\u043A\u0435\u0442",birthDay:"1996-11-07",phone:"",lastSession:"2020-03-28T21:24:00",photo:"img/ava8.jpg",university:"\u0412\u0417\u0424\u0418",course:"4",friends:{count:"600",data:[]}}]},ObjectsToStudents(a){const b=[];for(let c of a)b.push(new Student(c));return b},students:[]};function getClassesWithModifiers(a,b){let c=a;if(b)for(let d of b)c+=` ${a}_${d}`;return c}function renderCardPerson(a){const b=renderCardImg({src:a.photo,modifiers:["round"],alt:`${a.name}, ${a.university} ${a.course} курс`}),c=renderCardTitle({text:a.name,modifiers:["nowrap"]}),d=renderCardDescription({text:`${a.university} ${a.course} курс`});return`<div class="card card_person" data-id="${a.id}">${b}${c}${d}</div>`}function renderPopupStudent(a){const b=renderLastSession({date:a.lastSession}),c=renderCloseButton(),d=renderCardTitle({text:a.name,modifiers:["nowrap"]}),e=renderCardImg({src:a.photo,modifiers:["border"],alt:`Фото ${a.name}`}),f=renderBirthDay({date:a.birthDay}),g=renderPhone({phone:a.phone}),h=renderMessageButton({modifiers:["round","red"],id:a.id}),i=renderPersonsMiniList({id:a.id,friendsCount:a.friendsCount,friendsData:a.getFriendsData(4)});return`<div class="popup card card_popup">${b}${c}${d}${e}${f}${g}${h}${i}</div>`}function renderCardImg({src:b="img/ui/default_placeholder.jpg",alt:c="",modifiers:a}={}){const d=getClassesWithModifiers("card__img",a);return`<img  class="${d}" src="${b}" alt="${c}"/>`}function renderCardTitle({text:b="",modifiers:a}={}){const c=getClassesWithModifiers("card__title",a);return`<p class="${c}" title="${b}">${b}</p>`}function renderCardDescription({text:b="",modifiers:a}={}){const c=getClassesWithModifiers("card__description",a);return`<span class="${c}" title="${b}">${b}</span>`}function renderLastSession({date:a,modifiers:b}={}){const c=getClassesWithModifiers("card__last-session",b),d=`Был(-а) в сети ${renderTextDate(a)}`;return`<p class="${c}" title="${d}">${d}</p>`}function renderTextDate(a){let b="\u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u043E";const c=new Date,d=Math.floor((c-a)/864000000);if(a){const c=`${a.getHours()}:${a.getMinutes()}`;b=`${["\u0441\u0435\u0433\u043E\u0434\u043D\u044F","\u0432\u0447\u0435\u0440\u0430","\u043F\u043E\u0437\u0430\u0432\u0447\u0435\u0440\u0430"][d]||a.toLocaleDateString()} в ${c}`}return b}function renderCloseButton({modifiers:a=[]}={}){const b=getClassesWithModifiers("card__close-button",a);return`<div class="${b}" title="Закрыть"></div>`}function renderBirthDay({date:a,modifiers:b=[]}={}){let c="\u0441\u043A\u0440\u044B\u0442\u043E";if(a){const b=getFullYears(a),d=6>(b+1)%10?`${b} года`:`${b} лет`;c=`${a.getDate()} ${["\u044F\u043D\u0432\u0430\u0440\u044F","\u0444\u0435\u0432\u0440\u0430\u043B\u044F","\u043C\u0430\u0440\u0442\u0430","\u0430\u043F\u0440\u0435\u043B\u044F","\u043C\u0430\u044F","\u0438\u044E\u043D\u044F","\u0438\u044E\u043B\u044F","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F","\u043E\u043A\u0442\u044F\u0431\u0440\u044F","\u043D\u043E\u044F\u0431\u0440\u044F","\u0434\u0435\u043A\u0430\u0431\u0440\u044F"][a.getMonth()]}, ${d}`}const d=getClassesWithModifiers("card__birthday",b);return`<p class="${d} card__birthday_label" title="День рождения">День рождения</p>
            <p class="${d}" title="${c}">${c}</p>`}function getFullYears(a){if(a){const b=new Date;let c=b.getFullYear()-a.getFullYear();return(b.getMonth()<a.getMonth()||b.getMonth()===a.getMonth()&&b.getDate()<a.getDate())&&c--,c.toString()}return""}function renderPhone({phone:a,modifiers:b=[]}){const c=renderPhoneText(a),d=getClassesWithModifiers("card__phone",b);return`<p class="${d} card__phone_label" title="Телефон">Телефон</p>
            <p class="${d}" title="${c}">${c}</p>`}function renderPhoneText(a){let b="";if(a){const c=[a.substr(0,1),a.substr(1,3),a.substr(4,3),a.substr(7,2),a.substr(9,2)];b=`+${c[0]}(${c[1]})${c[2]}-${c[3]}-${c[4]}`}return b}function renderMessageButton({id:a,modifiers:b=[]}){const c=getClassesWithModifiers("card__message",b);return`<a href="/im?sel=${a}" class="${c}"></a>`}function renderPersonsMiniList({id:a,friendsCount:b,friendsData:c,modifiers:d=[]}){const e=getClassesWithModifiers("persons-mini-list",d),f=renderPersonsMiniListLink({friendsCount:b});let g="";const h=Math.min(c.length,4);for(let e=0;e<h;e++)g+=renderPersonsMiniListAva(c[e]);return`<div class="${e}">${f}${g}</div>`}function renderPersonsMiniListLink({friendsCount:a,modifiers:b=[]}){const c=getClassesWithModifiers("persons-mini-list__link",b);return`<a href="/friends/" class="${c}">Друзей ${a||0}</a>`}function renderPersonsMiniListAva({name:a,photo:b="/img/ui/default_placeholder.jpg",modifiers:c=[]}){const d=getClassesWithModifiers("persons-mini-list__ava",c);return`<img src="${b}" alt="${a||""}" class="${d}"/>`}function getPopupStack(){return document.querySelector(".popup-stack")}function calcPopupPosition({pageX:a=0,pageY:b=0,width:c=0,height:d=0}){return{x:Math.max(Math.min(a,window.innerWidth-c-20),0),y:Math.max(b-d/3,0)}}function onPersonClick(a){a.stopPropagation();const b=studentModel.students.find(a=>a.id===this.dataset.id);showPopup(b,a.pageX,a.pageY)}function showPopup(a,b,c){const d=getPopupStack();let e;closePopup(),d.innerHTML=a.createPopup(),e=d.firstElementChild;const f=calcPopupPosition({pageX:b,pageY:c,width:e.clientWidth,height:e.clientHeight});e.style.left=f.x+"px",e.style.top=f.y+"px",setCloseEvent(e)}function onClosePopup(){closePopup()}function closePopup(){const a=getPopupStack();if(a.innerHTML){const b=a.firstElementChild;removeCloseEvent(b),a.innerHTML=""}}function setCloseEvent(a){a.querySelector(".popup .card__close-button").addEventListener("click",onClosePopup)}function removeCloseEvent(a){a.querySelector(".popup .card__close-button").removeEventListener("click",onClosePopup)}function hoverPopup(a){let b=setTimeout(onPersonClick.bind(this,a),2e3);const c=this,d=()=>{window.clearTimeout(b),c.removeEventListener("mouseleave",d)};c.addEventListener("mouseleave",d)}const dataFromServer=studentModel.getData();studentModel.students=studentModel.ObjectsToStudents(dataFromServer);const persons=document.querySelector(".persons");let studentsHtml="";for(let a of studentModel.students)studentsHtml+=a.createCardPerson();persons.innerHTML=studentsHtml;const personsCollection=document.querySelectorAll(".persons .card_person");for(let a of personsCollection)a.addEventListener("click",onPersonClick),a.addEventListener("mouseenter",hoverPopup);document.addEventListener("click",function(a){const b=getPopupStack(),c=b.firstElementChild;c&&!c.contains(a.target)&&onClosePopup()});